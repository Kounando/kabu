<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>架空の株式シミュレーション</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>架空の株式シミュレーション</h1>
    <div id="chart"></div>
    <h2 id="finalValue"></h2>
    
    <script>
        // ランダムな株価データを生成
        function generateStockPrices(days, initialPrice, volatility) {
            let prices = [initialPrice];
            for (let i = 1; i < days; i++) {
                let change = (Math.random() - 0.5) * volatility;
                prices.push(Math.max(50, prices[i - 1] + change));
            }
            return prices;
        }
        
        // RSI計算
        function computeRSI(prices, period = 14) {
            let rsi = new Array(prices.length).fill(50);
            for (let i = period; i < prices.length; i++) {
                let gains = 0, losses = 0;
                for (let j = i - period; j < i; j++) {
                    let diff = prices[j + 1] - prices[j];
                    if (diff > 0) gains += diff;
                    else losses -= diff;
                }
                let rs = gains / (losses + 1e-10);
                rsi[i] = 100 - (100 / (1 + rs));
            }
            return rsi;
        }
        
        let days = 100;
        let prices = generateStockPrices(days, 100, 5);
        let rsi = computeRSI(prices);
        
        let cash = 10000;
        let stocks = 0;
        let buySignals = [], sellSignals = [];
        
        for (let i = 0; i < days; i++) {
            if (rsi[i] < 30 && cash >= prices[i]) { 
                stocks = Math.floor(cash / prices[i]);
                cash -= stocks * prices[i];
                buySignals.push({x: i, y: prices[i]});
            } else if (rsi[i] > 70 && stocks > 0) {
                cash += stocks * prices[i];
                stocks = 0;
                sellSignals.push({x: i, y: prices[i]});
            }
        }
        
        let finalValue = cash + stocks * prices[prices.length - 1];
        document.getElementById("finalValue").innerText = `最終資産価値: $${finalValue.toFixed(2)}`;
        
        let trace1 = {
            x: Array.from({length: days}, (_, i) => i),
            y: prices,
            mode: 'lines',
            name: '株価'
        };
        
        let trace2 = {
            x: buySignals.map(p => p.x),
            y: buySignals.map(p => p.y),
            mode: 'markers',
            name: '買いシグナル',
            marker: {color: 'green', size: 10}
        };
        
        let trace3 = {
            x: sellSignals.map(p => p.x),
            y: sellSignals.map(p => p.y),
            mode: 'markers',
            name: '売りシグナル',
            marker: {color: 'red', size: 10}
        };
        
        Plotly.newPlot('chart', [trace1, trace2, trace3]);
    </script>
</body>
</html>
